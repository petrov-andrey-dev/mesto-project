(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{W:()=>w});var e=document.querySelector(".popup__big-image"),n=document.querySelector(".popup__figcaption"),o=document.querySelector(".posts__grid"),r=document.querySelector(".profile__add-post"),c=document.querySelector("#caption"),a=document.querySelector("#link");function u(t,e,n,o,r){var c=document.querySelector("#post").content.querySelector(".post").cloneNode(!0),a=c.querySelector(".post__img"),u=c.querySelector(".post__trash"),l=c.querySelector(".post__like");return a.src=t,a.alt=e,c.querySelector(".post__title").textContent=e,c.setAttribute("data-id","".concat(r)),i(c,n),function(t){return t.some((function(t){return t._id===w}))}(n)&&s(l),o!==w&&u.remove(),c}function i(t,e){t.querySelector(".post__like-counter").textContent=e.length}function s(t){t.classList.toggle("post__like_liked")}function l(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.disabled=!1:e.disabled=!0}var d=document.querySelectorAll(".popup__submit");function p(t){"Escape"===t.key&&m(document.querySelector(".popup_opened"))}function f(t){t?d.forEach((function(t){t.textContent="Сохранение..."})):d.forEach((function(t){t.textContent="Сохранить"}))}function _(t,e){t.classList.add("popup_opened"),document.addEventListener("keydown",p)}function m(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",p)}var h={baseUrl:"https://nomoreparties.co/v1/plus-cohort-24",headers:{authorization:"e03c6a58-2a56-454c-8255-6314725b68cd","Content-Type":"application/json"}};function y(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}var v,S,g=document.querySelector(".profile__edit-avatar"),q=document.querySelector(".profile__edit-info"),b=document.querySelector(".profile__name"),k=document.querySelector(".profile__description"),E=document.querySelector("#name"),L=document.querySelector("#description"),C=document.querySelector("#link-avatar"),x=document.querySelector(".profile__avatar"),U=document.querySelector(".popup_type_edit"),A=document.querySelectorAll(".popup"),O=document.querySelector(".popup_type_add"),P=document.querySelector(".popup_type_image"),T=document.querySelector(".popup_type_edit-avatar"),w="fbff03813343a78265557f95";function j(t){return v=t.target.closest(".post")}function D(t){var e=t.target.querySelector(".popup__submit");m(t.target.closest(".popup")),t.target.reset(),e.disabled=!0}fetch("".concat(h.baseUrl,"/users/me"),{headers:h.headers}).then((function(t){return y(t)})).then((function(t){b.textContent=t.name,k.textContent=t.about,x.src=t.avatar})).catch((function(t){return console.log(t)})),fetch("".concat(h.baseUrl,"/cards"),{headers:h.headers}).then((function(t){return y(t)})).then((function(t){t.forEach((function(t){return o.append(u(t.link,t.name,t.likes,t.owner._id,t._id))}))})).catch((function(t){return console.log(t)})),o.addEventListener("click",(function(t){t.target.classList.contains("post__trash")&&function(t){j(t),function(t){fetch("".concat(h.baseUrl,"/cards/").concat(t.dataset.id),{method:"DELETE",headers:h.headers}).then((function(t){return y(t)}))}(v),v.remove()}(t)})),o.addEventListener("click",(function(t){t.target.classList.contains("post__like")&&function(t){var e;t.target.classList.contains("post__like")&&(j(t),t.target.classList.contains("post__like_liked")?function(t){return fetch("".concat(h.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:h.headers}).then((function(t){return y(t)}))}(v.dataset.id).then((function(e){s(t.target),i(v,e.likes)})).catch((function(t){return console.log(t)})):(e=v.dataset.id,fetch("".concat(h.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:h.headers}).then((function(t){return y(t)}))).then((function(e){s(t.target),i(v,e.likes)})).catch((function(t){return console.log(t)})))}(t)})),q.addEventListener("click",(function(t){_(U),E.value=b.textContent,L.value=k.textContent})),U.addEventListener("submit",(function(t){var e,n;t.preventDefault(),f(!0),(e=E.value,n=L.value,fetch("".concat(h.baseUrl,"/users/me"),{method:"PATCH",headers:h.headers,body:JSON.stringify({name:e,about:n})}).then((function(t){return y(t)}))).then((function(t){b.textContent=t.name,k.textContent=t.about})).catch((function(t){return console.log(t)})).finally((function(){return f(!1)})),D(t)})),r.addEventListener("click",(function(){_(O)})),O.addEventListener("submit",(function(t){var e,n;t.preventDefault(),f(!0),(e=a.value,n=c.value,fetch("".concat(h.baseUrl,"/cards"),{method:"POST",headers:h.headers,body:JSON.stringify({name:n,link:e})}).then((function(t){return y(t)}))).then((function(t){o.prepend(u(t.link,t.name,t.likes,t.owner._id,t._id))})).catch((function(t){return console.log(t)})).finally((function(){return f(!1)})),D(t)})),g.addEventListener("click",(function(){_(T)})),T.addEventListener("submit",(function(t){var e;t.preventDefault(),f(!0),(e=C.value,fetch("".concat(h.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:h.headers,body:JSON.stringify({avatar:e})}).then((function(t){return y(t)}))).then((function(e){x.src=e.avatar,m(t.target.closest(".popup"))})).catch((function(t){return console.log(t)})).finally((function(){return f(!1)})),D(t)})),A.forEach((function(t){t.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")?m(t.target):t.target.classList.contains("popup__close")&&m(t.target.closest(".popup"))}))})),o.addEventListener("click",(function(t){t.target.classList.contains("post__open-img")&&function(t){_(P),function(t){var o=t.target.closest(".post").querySelector(".post__title"),r=t.target.querySelector(".post__img");e.src=r.src,e.alt=o.textContent,n.textContent=o.textContent}(t)}(t)})),S={formSelector:".popup__form",inputSelector:".popup__text-input",submitButtonSelector:".popup__submit",inputErrorClass:"popup__text-input_type_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(S.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);l(n,o),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),l(n,o)}))}))}(t,S)}))})();